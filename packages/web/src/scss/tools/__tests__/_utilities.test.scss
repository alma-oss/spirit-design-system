@use 'sass:map';
@use 'true' as test;
@use '../utilities';

@include test.describe('generate-token-map function') {
    @include test.it('should return accent tokens filtered by scope for background colors') {
        @include test.assert-equal(
            utilities.generate-token-map(
                $tokens-group: 'accent-colors',
                $keys-to-generate: (
                    background-basic,
                    background-subtle,
                ),
                $prefix: 'accent-',
                $remove-from-name: 'background'
            ),
            (
                accent-01-basic: var(--spirit-color-accent-01-background-basic),
                accent-01-subtle: var(--spirit-color-accent-01-background-subtle),
                accent-02-basic: var(--spirit-color-accent-02-background-basic),
                accent-02-subtle: var(--spirit-color-accent-02-background-subtle),
            )
        );
    }

    @include test.it('should return an empty map if tokens do not exist') {
        @include test.assert-equal(
            utilities.generate-token-map($tokens-group: 'test-colors', $keys-to-generate: 'test'),
            ()
        );
    }

    @include test.it('should return an empty map if tokens do not match the scope') {
        @include test.assert-equal(
            utilities.generate-token-map(
                $tokens-group: 'accent-colors',
                $keys-to-generate: test,
                $prefix: '',
                $remove-from-name: ''
            ),
            ()
        );
    }
}

@include test.describe('generate-color-scheme-map function') {
    @include test.it('should return paired color schemes for emotion colors') {
        @include test.assert-equal(
            utilities.generate-color-scheme-map($tokens-group: 'emotion-colors', $prefix: 'emotion-'),
            (
                emotion-danger-basic: (
                    background-color: var(--spirit-color-emotion-danger-background-basic),
                    color: var(--spirit-color-emotion-danger-content-subtle),
                ),
                emotion-danger-subtle: (
                    background-color: var(--spirit-color-emotion-danger-background-subtle),
                    color: var(--spirit-color-emotion-danger-content-basic),
                ),
                emotion-informative-basic: (
                    background-color: var(--spirit-color-emotion-informative-background-basic),
                    color: var(--spirit-color-emotion-informative-content-subtle),
                ),
                emotion-informative-subtle: (
                    background-color: var(--spirit-color-emotion-informative-background-subtle),
                    color: var(--spirit-color-emotion-informative-content-basic),
                ),
                emotion-success-basic: (
                    background-color: var(--spirit-color-emotion-success-background-basic),
                    color: var(--spirit-color-emotion-success-content-subtle),
                ),
                emotion-success-subtle: (
                    background-color: var(--spirit-color-emotion-success-background-subtle),
                    color: var(--spirit-color-emotion-success-content-basic),
                ),
                emotion-warning-basic: (
                    background-color: var(--spirit-color-emotion-warning-background-basic),
                    color: var(--spirit-color-emotion-warning-content-subtle),
                ),
                emotion-warning-subtle: (
                    background-color: var(--spirit-color-emotion-warning-background-subtle),
                    color: var(--spirit-color-emotion-warning-content-basic),
                ),
            )
        );
    }

    @include test.it('should format numeric keys correctly for accent colors') {
        $result: utilities.generate-color-scheme-map(
            $tokens-group: 'accent-colors',
            $prefix: 'accent-',
        );

        // Check that keys are formatted as '01', '02' not '1', '2'
        @include test.assert-true(map.has-key($result, 'accent-01-basic'));
        @include test.assert-true(map.has-key($result, 'accent-02-basic'));
    }
}

@include test.describe('generate mixin') {
    @include test.it('should generate utility classes based on the provided utility map and infix') {
        $sample-utility: (
            property: display,
            class: d,
            values: (
                block,
                flex,
                grid,
                inline,
                inline-block,
                inline-flex,
                none,
            ),
        );

        @include test.assert() {
            @include test.output() {
                @include utilities.generate($sample-utility, '');
            }

            @include test.expect() {
                // stylelint-disable declaration-no-important -- We need to allow this to make sass-true work
                .d-block {
                    display: block !important;
                }

                .d-flex {
                    display: flex !important;
                }

                .d-grid {
                    display: grid !important;
                }

                .d-inline {
                    display: inline !important;
                }

                .d-inline-block {
                    display: inline-block !important;
                }

                .d-inline-flex {
                    display: inline-flex !important;
                }

                .d-none {
                    display: none !important;
                }
                // stylelint-enable declaration-no-important
            }
        }
    }

    @include test.it('should not fail if values are empty') {
        $sample-utility: (
            property: display,
            class: d,
            values: (),
        );

        @include test.assert() {
            @include test.output() {
                @include utilities.generate($sample-utility, '');
            }

            @include test.expect();
        }
    }

    @include test.it('should generate multi-property utilities when value is a map') {
        $sample-utility: (
            property: null,
            class: color-scheme-on,
            generate-custom-properties: true,
            values: (
                test-basic: (
                    background-color: #f00,
                    color: #fff,
                ),
            ),
        );

        @include test.assert() {
            @include test.output() {
                @include utilities.generate($sample-utility, '');
            }

            @include test.expect() {
                // stylelint-disable custom-property-empty-line-before, declaration-empty-line-before, declaration-no-important, order/order, order/properties-order -- We need to allow this to make sass-true work
                .color-scheme-on-test-basic {
                    --spirit-local-background-color: #f00;
                    background-color: #f00 !important;
                    --spirit-local-color: #fff;
                    color: #fff !important;
                }
                // stylelint-enable declaration-no-important
            }
        }
    }
}
